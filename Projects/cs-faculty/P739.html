<base href="http://www.cs.utexas.edu/~atharva//">
<!DOCTYPE html>
<html>

<head>
  <!--Import Google Icon Font-->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!--Import materialize.css-->
  <!--link type="text/css" rel="stylesheet" href="css/materialize.min.css" media="screen,projection" /-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="icon" href="kutx.png">
  <title>TuneX</title>
  <meta name="viewport" content="initial-scale=1.0">
  <meta charset="utf-8">
  <style>
    /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
    #wrapper {
      //height: 100%;
      position: relative;
    }
    #map {
      height: 100vh; //right = 0;
      //top = 25px;
    }
    /* Optional: Makes the sample page fill the window. */
    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
      background-image: url("bg3.jpg");
    }
  </style>
</head>

<body>
  <main>
    <!--<h5 align="center">  Welcome! Here are some live music venues in Austin. </h5>-->
    <nav>
      <div class="nav-wrapper purple">
        <a href="#!" class="brand-logo"><i class="material-icons">cloud</i>KUTX 98.9</a>
        <ul class="right hide-on-med-and-down">
          <!--<li><a href="sass.html"><i class="material-icons">search</i></a></li>-->
          <li><a href="login.html">Login</a></li>
          <li><a href="signup.html">Sign up</a></li>
        </ul>
      </div>
    </nav>
    <div class="row">
      <div class="col s3 m3 l3">
        <div class="card white">
          <div class="card-content">
            <span class="card-title" id="thistitle">Welcome to TuneX™! <br> Select an event to begin.</span>

            <p id="thisvenue"></p>
            <p><br><p>
            <p id="eventdate"></p>
            <p><br><p>
            <p id="eventgenre"></p>
            <p id="eventprice"></p>
          </div>
          <div class="card-action">
            <a id="thislink" target="_blank"></a>
          </div>
        </div>
      </div>
      <div class="col s9 m9 l9">
        <div id="map"></div>
      </div>
    </div>
  </main>

  <footer class="page-footer purple">
    <div class="container">
      <div class="row">
        <div class="col 6 s5">
          <h5 class="white-text">TUNEX</h5>
          <p class="grey-text text-lighten-4">The Austin Live Music Experience.</p>
        </div>
      </div>
    </div>
    <div class="footer-copyright">
      <div class="container">
        © 2018 Copyright
      </div>
    </div>
  </footer>
  <!--Import jQuery before materialize.js-->

  <script src="https://www.gstatic.com/firebasejs/4.9.1/firebase.js"></script>
  <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyB67-XtbW1fKsIsRcqrbRutKU_BH25Xxqw",
      authDomain: "kutx-981cf.firebaseapp.com",
      databaseURL: "https://kutx-981cf.firebaseio.com",
      projectId: "kutx-981cf",
      storageBucket: "kutx-981cf.appspot.com",
      messagingSenderId: "159063212301"
    };
    firebase.initializeApp(config);
  </script>
  <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <!--script type="text/javascript" src="js/materialize.min.js"></script-->


  <script>
  var home = {
    lat: 30.288,
    lng: -97.739
  };

  var map;
  var infowindow;

  function initMap() {
    map = new google.maps.Map(document.getElementById('map'), {
      center: home,
      zoom: 13.5,
      styles: [
          {
            featureType: 'poi',
            elementType: 'labels',
            stylers: [{visibility: 'off'}]
          }
        ]
    });
  }


    var data = [];
    var i = 0;

    var ref = firebase.database().ref();
    ref.once("value").then(function(snapshot) {
      for(var key in snapshot.val()) {
        data.push(snapshot.val()[key]);
      }
      console.log(data.length);



    //this is the fake data file for the event
    /*var data = [   {
            "venue":"Cactus Cafe",
            "artist":"Father John Misty",
            "date":"05/22/18",
            "genre":"Folk",
            "price":"$40",
            "kevent":"yes",
        },
        {
            "venue":"Spider House",
            "artist":"Hobo Johnson",
            "date":"08/17/18",
            "genre":"Rap",
            "price":"$15",
            "kevent":"no",
        },
        {
            "venue":"The Electric Church",
            "artist":"FIDLAR",
            "date":"09/10/18",
            "genre":"Rock",
            "price":"$5",
            "kevent":"yes",
        }
     ];*/

     for (x in data) {
       // Data attributes are Name, Address, Dat, Details, Imglink, Link, Location
         addevent();
         function addevent() {
            var v = data[x].Location;
            console.log(v);
            var a = data[x].Name;
            var addr = data[x].Address;
            console.log(a);
            var details = data[x].Details;
            var l = data[x].Link;
            var d = data[x].Dat;
            //console.log(d);
            infowindow = new google.maps.InfoWindow();
            var service = new google.maps.places.PlacesService(map);
            service.nearbySearch({
                location: home,
                radius: 5000,
                keyword: v
              }, callback);
              function callback(results, status) {
                if (status === google.maps.places.PlacesServiceStatus.OK) {
                   createMarker(results[0]);
                  }
                }
                function createMarker(place) {
                  var placeLoc = place.geometry.location;
                  var marker = new google.maps.Marker({
                    map: map,
                    position: place.geometry.location,
                    icon: "kutx.png",
                    animation: google.maps.Animation.DROP
                  });
                  google.maps.event.addListener(marker, 'click', function() {
                    document.getElementById('thistitle').innerHTML = "<b>" + a + "</b>";
                    document.getElementById('thisvenue').innerHTML = "<b>Where: </b>" + v + ",<br>"+addr;
                    document.getElementById('eventdate').innerHTML = "<b>When: </b>" + d + "<br>";
                    document.getElementById('eventgenre').innerHTML = "<b>Details: </b>" + details;
                    document.getElementById('thislink').innerHTML = "More Info";
                    document.getElementById('thislink').href = l;
                    map.setCenter(place.geometry.location);
                    infowindow.setContent(a + " @ " + v);
                    infowindow.open(map, this);
                  });
                }
              }
            }
          })
      </script>
      <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBwgbqGRXPPyYEqv98HTEb3JGHb32JGTWY&libraries=places&callback=initMap" async defer></script>
    </body>

</html>
